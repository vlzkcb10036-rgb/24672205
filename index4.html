<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ê°€ìœ„ë°”ìœ„ë³´ ê²Œì„</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            flex-direction: column;
        }
        .main-card {
            background-color: white;
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
            width: 90%;
            max-width: 450px;
            position: relative;
            min-height: 500px; /* ê³ ì • ë†’ì´ í™•ë³´ */
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        h1 { color: #333; margin-bottom: 20px; font-size: 22px; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary {
            background-color: #4e73df; color: white; border: none;
            padding: 12px 35px; font-size: 18px; font-weight: bold;
            border-radius: 50px; cursor: pointer; transition: all 0.2s ease;
            box-shadow: 0 4px 6px rgba(78, 115, 223, 0.3);
        }
        .btn-primary:hover { background-color: #2e59d9; transform: translateY(-2px); }
        .btn-primary:disabled { background-color: #a0aec0; cursor: not-allowed; transform: none; }

        /* í™”ë©´ ìš”ì†Œ ìˆ¨ê¹€ ì²˜ë¦¬ */
        .hidden { display: none !important; }

        /* ê²Œì„ ì˜ì—­ ìŠ¤íƒ€ì¼ */
        #game-area {
            position: relative;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #webcam-container {
            border-radius: 15px; overflow: hidden;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            line-height: 0;
            margin-bottom: 15px;
        }
        
        /* ì¹´ìš´íŠ¸ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
        #countdown-display {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px; font-weight: 900; color: #fff;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            z-index: 10;
        }

        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        #result-screen {
            width: 100%;
            animation: fadeIn 0.5s ease;
        }
        .result-box {
            background: #f8f9fc;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 18px;
        }
        .move-icon { font-size: 30px; }
        
        /* ìµœì¢… ê²°ê³¼ (WIN/LOSE) í…ìŠ¤íŠ¸ */
        #final-outcome {
            font-size: 40px;
            font-weight: 900;
            margin: 20px 0;
        }
        .outcome-win { color: #1cc88a; } /* ì´ˆë¡ìƒ‰ */
        .outcome-lose { color: #e74a3b; } /* ë¹¨ê°„ìƒ‰ */
        .outcome-draw { color: #f6c23e; } /* ë…¸ë€ìƒ‰ */
        
        .loading-msg { color: #666; font-size: 14px; margin-top: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="main-card">
        <h1>ğŸ¤– AI ê°€ìœ„ë°”ìœ„ë³´ ëŒ€ê²°</h1>

        <div id="start-screen">
            <p style="color:#666; margin-bottom: 30px;">ì¹´ë©”ë¼ ì•ì—ì„œ ì¤€ë¹„í•˜ì‹œê³ <br>ì‹œì‘ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!</p>
            <button type="button" class="btn-primary" onclick="startGame()" id="start-btn" disabled>ë¡œë”© ì¤‘...</button>
            <p class="loading-msg" id="loading-status">ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <div id="game-area" class="hidden">
            <div id="webcam-container"></div>
            <div id="countdown-display" class="hidden"></div>
            <p style="color:#666; font-size:14px;">ì¹´ìš´íŠ¸ê°€ ëë‚˜ë©´ ì†ì„ ë©ˆì¶”ì„¸ìš”!</p>
        </div>

        <div id="result-screen" class="hidden">
            <div class="result-box">
                <span>ë‚˜ì˜ ì„ íƒ</span>
                <span id="user-move-display">-</span>
            </div>
            <div class="result-box" style="background:#edf2ff;">
                <span>ì»´í“¨í„° ì„ íƒ</span>
                <span id="computer-move-display">-</span>
            </div>
            
            <div id="final-outcome"></div>
            <p style="color:#888; font-size:14px;">ì ì‹œ í›„ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        // --- ì„¤ì • ë¶€ë¶„ ---
        // ì—¬ê¸°ì— ì—¬ëŸ¬ë¶„ì˜ Teachable Machine ëª¨ë¸ ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš”.
        const URL = "https://teachablemachine.withgoogle.com/models/VCE0P0TSD/";
        
        // [ì¤‘ìš”] í‹°ì²˜ë¸” ë¨¸ì‹ ì—ì„œ í•™ìŠµì‹œí‚¨ í´ë˜ìŠ¤ ì´ë¦„ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤!
        const CLASS_NAMES = {
            ROCK: "ë°”ìœ„", // ë˜ëŠ” "Rock"
            PAPER: "ë³´",   // ë˜ëŠ” "Paper"
            SCISSORS: "ê°€ìœ„" // ë˜ëŠ” "Scissors"
        };

        // ì´ëª¨ì§€ ë§¤í•‘ (í™”ë©´ í‘œì‹œìš©)
        const EMOJI_MAP = {
            [CLASS_NAMES.ROCK]: "âœŠ ë°”ìœ„",
            [CLASS_NAMES.PAPER]: "ğŸ– ë³´",
            [CLASS_NAMES.SCISSORS]: "âœŒï¸ ê°€ìœ„"
        };
        // ----------------

        let model, webcam, maxPredictions;
        let isModelLoaded = false;

        // 1. í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë¸ê³¼ ì›¹ìº ì„ ë¯¸ë¦¬ ì¤€ë¹„í•©ë‹ˆë‹¤.
        async function init() {
            const statusMsg = document.getElementById("loading-status");
            const startBtn = document.getElementById("start-btn");

            try {
                const modelURL = URL + "model.json";
                const metadataURL = URL + "metadata.json";
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                statusMsg.innerText = "ì›¹ìº  ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”...";
                const flip = true;
                webcam = new tmImage.Webcam(250, 250, flip); // í¬ê¸° ì•½ê°„ í‚¤ì›€
                await webcam.setup();
                await webcam.play();
                window.requestAnimationFrame(loop);

                document.getElementById("webcam-container").appendChild(webcam.canvas);
                
                isModelLoaded = true;
                startBtn.disabled = false;
                startBtn.innerText = "ê²Œì„ ì‹œì‘!";
                statusMsg.innerText = "ì¤€ë¹„ ì™„ë£Œ!";
                statusMsg.style.color = "#1cc88a";

            } catch (error) {
                statusMsg.innerText = "ì˜¤ë¥˜ ë°œìƒ! (ì›¹ìº  ê¶Œí•œì„ í™•ì¸í•˜ì„¸ìš”)";
                statusMsg.style.color = "red";
                console.error(error);
            }
        }

        // ì›¹ìº  í™”ë©´ì„ ê³„ì† ì—…ë°ì´íŠ¸ (ì˜ˆì¸¡ì€ í•˜ì§€ ì•ŠìŒ)
        async function loop() {
            webcam.update();
            window.requestAnimationFrame(loop);
        }

        // 2. ê²Œì„ ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ
        function startGame() {
            if (!isModelLoaded) return;

            // í™”ë©´ ì „í™˜
            document.getElementById("start-screen").classList.add("hidden");
            document.getElementById("game-area").classList.remove("hidden");
            document.getElementById("result-screen").classList.add("hidden");

            // ì¹´ìš´íŠ¸ë‹¤ìš´ ì‹œì‘
            runCountdown();
        }

        // 3. 3-2-1 ì¹´ìš´íŠ¸ë‹¤ìš´
        function runCountdown() {
            const countdownDisplay = document.getElementById("countdown-display");
            countdownDisplay.classList.remove("hidden");
            
            let count = 3;
            countdownDisplay.innerText = count;
            
            const timer = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownDisplay.innerText = count;
                } else {
                    clearInterval(timer);
                    countdownDisplay.innerText = ""; // ìˆ«ì ìˆ¨ê¹€
                    countdownDisplay.classList.add("hidden");
                    playRound(); // ê²Œì„ íŒì • ì‹œì‘
                }
            }, 1000); // 1ì´ˆ ê°„ê²©
        }

        // 4. ì‹¤ì œ ê²Œì„ íŒì • (ìˆœê°„ í¬ì°©)
        async function playRound() {
            // ì‚¬ìš©ì ì† ëª¨ì–‘ ì˜ˆì¸¡ (ê°€ì¥ ë†’ì€ í™•ë¥ ì˜ í´ë˜ìŠ¤ ê°€ì ¸ì˜¤ê¸°)
            const prediction = await model.predict(webcam.canvas);
            let userMove = "";
            let maxProb = 0;
            
            for (let i = 0; i < maxPredictions; i++) {
                if (prediction[i].probability > maxProb) {
                    maxProb = prediction[i].probability;
                    userMove = prediction[i].className;
                }
            }

            // ì»´í“¨í„° ëœë¤ ì„ íƒ
            const computerMoves = [CLASS_NAMES.ROCK, CLASS_NAMES.PAPER, CLASS_NAMES.SCISSORS];
            const computerMove = computerMoves[Math.floor(Math.random() * computerMoves.length)];

            // ìŠ¹íŒ¨ ê²°ì •
            const result = determineWinner(userMove, computerMove);

            // ê²°ê³¼ í™”ë©´ í‘œì‹œ
            showResult(userMove, computerMove, result);
        }

        // ìŠ¹íŒ¨ íŒì • ë¡œì§
        function determineWinner(user, computer) {
            if (user === computer) {
                return "DRAW";
            }
            if (
                (user === CLASS_NAMES.ROCK && computer === CLASS_NAMES.SCISSORS) ||
                (user === CLASS_NAMES.PAPER && computer === CLASS_NAMES.ROCK) ||
                (user === CLASS_NAMES.SCISSORS && computer === CLASS_NAMES.PAPER)
            ) {
                return "WIN";
            }
            return "LOSE";
        }

        // 5. ê²°ê³¼ í™”ë©´ ì¶œë ¥ ë° ì´ˆê¸°í™” ì˜ˆì•½
        function showResult(userMove, computerMove, result) {
            document.getElementById("game-area").classList.add("hidden");
            document.getElementById("result-screen").classList.remove("hidden");

            // ì„ íƒ ê²°ê³¼ í‘œì‹œ (ì´ëª¨ì§€ ë§¤í•‘ ì‚¬ìš©)
            document.getElementById("user-move-display").innerText = EMOJI_MAP[userMove] || userMove;
            document.getElementById("computer-move-display").innerText = EMOJI_MAP[computerMove] || computerMove;

            const outcomeText = document.getElementById("final-outcome");
            outcomeText.className = ""; // ê¸°ì¡´ í´ë˜ìŠ¤ ì´ˆê¸°í™”

            if (result === "WIN") {
                outcomeText.innerText = "ğŸ‰ WIN!";
                outcomeText.classList.add("outcome-win");
            } else if (result === "LOSE") {
                outcomeText.innerText = "ğŸ˜­ LOSE...";
                outcomeText.classList.add("outcome-lose");
            } else {
                outcomeText.innerText = "ğŸ¤ DRAW";
                outcomeText.classList.add("outcome-draw");
            }

            // 3ì´ˆ í›„ ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ë¦¬ì…‹
            setTimeout(() => {
                document.getElementById("result-screen").classList.add("hidden");
                document.getElementById("start-screen").classList.remove("hidden");
            }, 3000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™” í•¨ìˆ˜ ì‹¤í–‰
        init();

    </script>
</body>
</html>